"use strict";var cov_18s4izwvnr=function(){var path="/Users/A1/Downloads/bueno2/src/backend/middleware/auth_middleware.ts",hash="94f10710fb095bcd6b9e52a41b3d2a58987050c6",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/A1/Downloads/bueno2/src/backend/middleware/auth_middleware.ts",statementMap:{"0":{start:{line:2,column:22},end:{line:4,column:1}},"1":{start:{line:3,column:4},end:{line:3,column:62}},"2":{start:{line:5,column:0},end:{line:5,column:62}},"3":{start:{line:6,column:21},end:{line:6,column:61}},"4":{start:{line:8,column:4},end:{line:53,column:5}},"5":{start:{line:9,column:8},end:{line:9,column:52}},"6":{start:{line:11,column:20},end:{line:11,column:48}},"7":{start:{line:15,column:8},end:{line:49,column:9}},"8":{start:{line:16,column:12},end:{line:16,column:45}},"9":{start:{line:17,column:12},end:{line:17,column:49}},"10":{start:{line:21,column:25},end:{line:21,column:48}},"11":{start:{line:23,column:12},end:{line:48,column:13}},"12":{start:{line:24,column:16},end:{line:24,column:59}},"13":{start:{line:25,column:16},end:{line:25,column:63}},"14":{start:{line:28,column:30},end:{line:28,column:36}},"15":{start:{line:29,column:16},end:{line:40,column:17}},"16":{start:{line:31,column:20},end:{line:31,column:75}},"17":{start:{line:33,column:20},end:{line:33,column:45}},"18":{start:{line:38,column:20},end:{line:38,column:53}},"19":{start:{line:39,column:20},end:{line:39,column:58}},"20":{start:{line:43,column:16},end:{line:43,column:45}},"21":{start:{line:44,column:16},end:{line:44,column:49}},"22":{start:{line:46,column:16},end:{line:46,column:37}},"23":{start:{line:47,column:16},end:{line:47,column:23}},"24":{start:{line:52,column:8},end:{line:52,column:31}},"25":{start:{line:55,column:0},end:{line:55,column:40}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:56},end:{line:2,column:57}},loc:{start:{line:2,column:71},end:{line:4,column:1}},line:2},"1":{name:"authMiddleware",decl:{start:{line:7,column:9},end:{line:7,column:23}},loc:{start:{line:7,column:40},end:{line:54,column:1}},line:7}},branchMap:{"0":{loc:{start:{line:2,column:22},end:{line:4,column:1}},type:"binary-expr",locations:[{start:{line:2,column:23},end:{line:2,column:27}},{start:{line:2,column:31},end:{line:2,column:51}},{start:{line:2,column:56},end:{line:4,column:1}}],line:2},"1":{loc:{start:{line:3,column:11},end:{line:3,column:61}},type:"cond-expr",locations:[{start:{line:3,column:37},end:{line:3,column:40}},{start:{line:3,column:43},end:{line:3,column:61}}],line:3},"2":{loc:{start:{line:3,column:12},end:{line:3,column:33}},type:"binary-expr",locations:[{start:{line:3,column:12},end:{line:3,column:15}},{start:{line:3,column:19},end:{line:3,column:33}}],line:3},"3":{loc:{start:{line:15,column:8},end:{line:49,column:9}},type:"if",locations:[{start:{line:15,column:8},end:{line:49,column:9}},{start:{line:15,column:8},end:{line:49,column:9}}],line:15},"4":{loc:{start:{line:15,column:12},end:{line:15,column:55}},type:"binary-expr",locations:[{start:{line:15,column:12},end:{line:15,column:31}},{start:{line:15,column:35},end:{line:15,column:55}}],line:15},"5":{loc:{start:{line:23,column:12},end:{line:48,column:13}},type:"if",locations:[{start:{line:23,column:12},end:{line:48,column:13}},{start:{line:23,column:12},end:{line:48,column:13}}],line:23},"6":{loc:{start:{line:33,column:20},end:{line:33,column:45}},type:"if",locations:[{start:{line:33,column:20},end:{line:33,column:45}},{start:{line:33,column:20},end:{line:33,column:45}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},f:{"0":0,"1":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var __importDefault=(cov_18s4izwvnr.s[0]++,(cov_18s4izwvnr.b[0][0]++,this)&&(cov_18s4izwvnr.b[0][1]++,this.__importDefault)||(cov_18s4izwvnr.b[0][2]++,function(mod){cov_18s4izwvnr.f[0]++;cov_18s4izwvnr.s[1]++;return(cov_18s4izwvnr.b[2][0]++,mod)&&(cov_18s4izwvnr.b[2][1]++,mod.__esModule)?(cov_18s4izwvnr.b[1][0]++,mod):(cov_18s4izwvnr.b[1][1]++,{"default":mod});}));cov_18s4izwvnr.s[2]++;Object.defineProperty(exports,"__esModule",{value:true});var jsonwebtoken_1=(cov_18s4izwvnr.s[3]++,__importDefault(require("jsonwebtoken")));function authMiddleware(req,res,next){cov_18s4izwvnr.f[1]++;cov_18s4izwvnr.s[4]++;try{cov_18s4izwvnr.s[5]++;console.log("Authorization authMiddleware");// Read token from request headers
var token=(cov_18s4izwvnr.s[6]++,req.headers["authorization"]);//console.log(req.headers);
// console.log(req.headers["authorization"]);
// If no token not a string, it is an invalid request
cov_18s4izwvnr.s[7]++;if((cov_18s4izwvnr.b[4][0]++,token===undefined)||(cov_18s4izwvnr.b[4][1]++,Array.isArray(token))){cov_18s4izwvnr.b[3][0]++;cov_18s4izwvnr.s[8]++;console.log(" 400 Bad request!");cov_18s4izwvnr.s[9]++;res.status(400).send("Bad request!");}else{cov_18s4izwvnr.b[3][1]++;// Read secret from environment variables
var secret=(cov_18s4izwvnr.s[10]++,process.env.AUTH_SECRET);// If secret is undefined, there is an internal server error
cov_18s4izwvnr.s[11]++;if(!secret){cov_18s4izwvnr.b[5][0]++;cov_18s4izwvnr.s[12]++;console.log(" 500 Internal Server Error!");cov_18s4izwvnr.s[13]++;res.status(500).send("Internal Server Error!");}else{cov_18s4izwvnr.b[5][1]++;var decoded=(cov_18s4izwvnr.s[14]++,void 0);cov_18s4izwvnr.s[15]++;try{cov_18s4izwvnr.s[16]++;// Decode token and get user id
decoded=jsonwebtoken_1.default.verify(token,secret);////////////////////////////////////////////////////////////////////
cov_18s4izwvnr.s[17]++;if(token===secret){cov_18s4izwvnr.b[6][0]++;}else{cov_18s4izwvnr.b[6][1]++;};}catch(e){cov_18s4izwvnr.s[18]++;// If cannot decode token, the user is unauthorized
console.log("401 Unauthorized!");cov_18s4izwvnr.s[19]++;res.status(401).send("Unauthorized!");}// Attach current user to request objs
// Note that we don't need to do additional db queries
cov_18s4izwvnr.s[20]++;req.body.userId=decoded.id;cov_18s4izwvnr.s[21]++;console.log(" User authorized!");// Invoke next handler
cov_18s4izwvnr.s[22]++;console.log(" next");cov_18s4izwvnr.s[23]++;next();}}}catch(e){cov_18s4izwvnr.s[24]++;res.status(500).send();}}cov_18s4izwvnr.s[25]++;exports.authMiddleware=authMiddleware;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL0ExL0Rvd25sb2Fkcy9idWVubzIvc3JjL2JhY2tlbmQvbWlkZGxld2FyZS9hdXRoX21pZGRsZXdhcmUudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9BMS9Eb3dubG9hZHMvYnVlbm8yL3NyYy9iYWNrZW5kL21pZGRsZXdhcmUvYXV0aF9taWRkbGV3YXJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsOERBQStCO0FBRS9CLHdCQUNJLEdBQW9CLEVBQ3BCLEdBQXFCLEVBQ3JCLElBQTBCO0lBRTFCLElBQUk7UUFDQSxPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7UUFDNUMsa0NBQWtDO1FBQ2xDLElBQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDM0MsMkJBQTJCO1FBQzVCLDZDQUE2QztRQUM1QyxxREFBcUQ7UUFDckQsSUFBSSxLQUFLLEtBQUssU0FBUyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQ2pDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1NBQ3hDO2FBQU07WUFDSCx5Q0FBeUM7WUFDekMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7WUFDdkMsNERBQTREO1lBQzVELElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO2dCQUMzQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO2FBQ2xEO2lCQUFNO2dCQUNILElBQUksT0FBTyxTQUFLLENBQUM7Z0JBQ2pCLElBQUk7b0JBQ0EsK0JBQStCO29CQUMvQixPQUFPLEdBQUcsc0JBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBUSxDQUFDO29CQUMzQyxvRUFBb0U7b0JBQ3BFLElBQUcsS0FBSyxLQUFJLE1BQU0sRUFBQyxHQUFFO29CQUFBLENBQUM7aUJBQ3pCO2dCQUFDLE9BQU0sQ0FBQyxFQUFFO29CQUNQLG1EQUFtRDtvQkFDbkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO29CQUNqQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztpQkFDekM7Z0JBQ0Qsc0NBQXNDO2dCQUN0QyxzREFBc0Q7Z0JBQ3JELEdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ3RDLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFFakMsc0JBQXNCO2dCQUN0QixPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNyQixJQUFJLEVBQUUsQ0FBQzthQUNWO1NBQ0o7S0FDSjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztLQUMxQjtBQUNMLENBQUM7QUEvQ0Qsd0NBK0NDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXV0aE1pZGRsZXdhcmUoXHJcbiAgICByZXE6IGV4cHJlc3MuUmVxdWVzdCxcclxuICAgIHJlczogZXhwcmVzcy5SZXNwb25zZSxcclxuICAgIG5leHQ6IGV4cHJlc3MuTmV4dEZ1bmN0aW9uXHJcbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkF1dGhvcml6YXRpb24gYXV0aE1pZGRsZXdhcmVcIik7XHJcbiAgICAgICAgLy8gUmVhZCB0b2tlbiBmcm9tIHJlcXVlc3QgaGVhZGVyc1xyXG4gICAgICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnNbXCJhdXRob3JpemF0aW9uXCJdO1xyXG4gICAgICAgIC8vY29uc29sZS5sb2cocmVxLmhlYWRlcnMpO1xyXG4gICAgICAgLy8gY29uc29sZS5sb2cocmVxLmhlYWRlcnNbXCJhdXRob3JpemF0aW9uXCJdKTtcclxuICAgICAgICAvLyBJZiBubyB0b2tlbiBub3QgYSBzdHJpbmcsIGl0IGlzIGFuIGludmFsaWQgcmVxdWVzdFxyXG4gICAgICAgIGlmICh0b2tlbiA9PT0gdW5kZWZpbmVkIHx8IEFycmF5LmlzQXJyYXkodG9rZW4pKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIDQwMCBCYWQgcmVxdWVzdCFcIik7XHJcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5zZW5kKFwiQmFkIHJlcXVlc3QhXCIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFJlYWQgc2VjcmV0IGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzXHJcbiAgICAgICAgICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkFVVEhfU0VDUkVUO1xyXG4gICAgICAgICAgICAvLyBJZiBzZWNyZXQgaXMgdW5kZWZpbmVkLCB0aGVyZSBpcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcclxuICAgICAgICAgICAgaWYgKCFzZWNyZXQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIDUwMCBJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IhXCIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IhXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IGRlY29kZWQ6IGFueTtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVjb2RlIHRva2VuIGFuZCBnZXQgdXNlciBpZFxyXG4gICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBzZWNyZXQpIGFzIGFueTtcclxuICAgICAgICAgICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRva2VuPT09IHNlY3JldCl7fTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGNhbm5vdCBkZWNvZGUgdG9rZW4sIHRoZSB1c2VyIGlzIHVuYXV0aG9yaXplZFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiNDAxIFVuYXV0aG9yaXplZCFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJVbmF1dGhvcml6ZWQhXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gQXR0YWNoIGN1cnJlbnQgdXNlciB0byByZXF1ZXN0IG9ianNcclxuICAgICAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB3ZSBkb24ndCBuZWVkIHRvIGRvIGFkZGl0aW9uYWwgZGIgcXVlcmllc1xyXG4gICAgICAgICAgICAgICAgKHJlcSBhcyBhbnkpLmJvZHkudXNlcklkID0gZGVjb2RlZC5pZDtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIFVzZXIgYXV0aG9yaXplZCFcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSW52b2tlIG5leHQgaGFuZGxlclxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIgbmV4dFwiKTtcclxuICAgICAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCgpO1xyXG4gICAgfVxyXG59Il19